{% extends "base.html" %}

{% block content %}

<div class="div-table" style="width:100%; min-height:650px; ">
    <div>
        <div style= "float:left;"></div>
        <div style="float:right;">
            <a href="/d_delete?id={{name}}" class="btn bt-red" data-toggle="tool" title="Delete Dataset" style="margin: 3px;"><i class="glyphicon glyphicon-remove-sign"></i></a>
        </div>
    </div>

    <div>
        <div>
            <h1>Dataset: <span  style="font-size: 20px;">{{data_detail.meta.titles.0}}</span> <span style="font-size: 12px;">#{{name}}</span> </h1>
        </div>
        <br>
        <div>
            {% for k,v in model.additionalInfo.items %}
            {% if k == "r.squared" %}
                    <div>
                        <label class="align">Rsquared:</label>
                        <input type="text" style="margin:5px;width:40%;" readonly="readonly" value="{{v.0}}">
                    </div>
                    <span style="font-size: 10px;margin-left: 10%;"><b>Help note:</b>Rsquared greater or equal to Rsquared threshold</span>
            {% endif %}
            {% endfor %}
            {% for k,v in model.additionalInfo.items %}
            {% if k == "norm.var" %}
                    <div>
                        <label class="align">Normalised variance:</label>
                        <input type="text" style="margin:5px;width:40%;" readonly="readonly" value="{{v.0}}">
                    </div>
                    <span style="font-size: 10px;margin-left: 10%;"><b>Help note:</b>Minimax normalised variance over input matrix.</span>
            {% endif %}
            {% endfor %}
            {% for k,v in model.additionalInfo.items %}
            {% if k == "confounding.effect" %}
                    <div>
                        <label class="align">Confounding effect:</label>
                        <input type="text" style="margin:5px;width:40%;" readonly="readonly" value="{{v.0}}">
                    </div>
                    <span style="font-size: 10px;margin-left: 10%;"><b>Help note:</b>The diagonality of the design.</span>
            {% endif %}
            {% endfor %}
            {% for k,v in model.additionalInfo.items %}
            {% if k == "verbal.notes" %}
                    <p><b>Notes:</b></p>
                    <textarea class="form-control" rows="3" readonly="readonly" style="margin:5px;width:50%;">{% for note in v %}
                        {{note}}{% endfor %}
                         </textarea>
            {% endif %}
            {% endfor %}
        </div>

        <input type="search" id="search1" onsearch="myFunction()" style="display:none">

    </div>


    <div id="details">

         <table id="dataset" class="div-form-table display" >
             <thead>
                 <tr>

                     <th style="background-color: #cf2323; min-width: 300px;">Compounds</th>
                       <th style="background-color: #cf2323;" class="column">
                            <p>{{predicted.0}}</p>
                       </th>
                       <th style="background-color: #cf2323;" class="column">
                            <p>Prediction feature</p>
                       </th>
                 </tr>
             </thead>
             <tbody>
             {% for key in data_detail.dataEntry%}
                    <tr>
                        <td>{{key.compound.name}}</td>
                        {% for k,v in key.values.items %}
                            {% if k == predicted.0%}
                                <td>{{v}}</td>
                            {% endif %}
                            {% if k == prediction %}
                                <td>{{v}}</td>
                            {% endif %}

                        {% endfor%}

                    </tr>
             {% endfor %}

             </tbody>
         </table>
        <br>

    </div>
    <input type="submit" id="exp" value="Experimental Design" class="btn bt-red" style="width: 20%;">

</div>

<script>

     $(document).ready( function () {

        var oTable = $('#dataset').DataTable( {
        "bJQueryUI": true,
        "bScrollCollapse": true,
        "bAutoWidth": false,
        "bPaginate":false,
        "dom": 'ft',
        "sScrollX": "100%",
        "sScrollXInner": "100%",
        "editable": true,

         "fnDrawCallback": function( oSettings )
         {
            $('.dataTables_scrollBody table thead tr').css({ 'height' : '0px' });
        },
        "fnInitComplete": function(oSettings, json)
         {
            $('.dataTables_scrollBody table thead tr').css({ 'height' : '0px' });
        },
        "fnRowCallback": function( nRow, aData, iDisplayIndex, iDisplayIndexFull ) {
        switch(aData[1]){
            case '1':
                $(nRow).css('color', 'red')
                break;
        }
        var tab = $('#dataset').DataTable();
        tab.columns(1).visible( false );
    }

        });

    } );


function myFunction() {
            var tab = $('#dataset').DataTable();
            tab.columns(1).visible( false );
            //tab.columns('.column').visible( false );
            for ( var i=1 ; i<4 ; i++ ) {
                tab.columns(i).visible( false );
            }
            tab.columns(':contains(A2V)').visible( true );
            tab.columns.adjust().draw( false ); // adjust column sizing and redraw
        }
$(function () {
  $('[data-toggle="tooltip"]').tooltip({
    container : 'body'
  });


});

//display tooltip right
$('[data-toggle="tool"]').tooltip({
    'placement': 'left'
});

/* setTimeout(function ()
  {
    oTable.fnAdjustColumnSizing();
  }, 10 );*/
 $('#dataset tbody td').editable( function( sValue ) {
		/* Get the position of the current data from the node */
		 var oTable = $('#dataset').dataTable()
		var aPos = oTable.fnGetPosition( this );

		/* Get the data array for this row */
		var aData = oTable.fnGetData( aPos[0] );

		/* Update the data array and return the value */
		aData[ aPos[2] ] = sValue;
		return sValue;
	}, { "onblur": 'submit' } ); /* Submit the form when bluring a field */

 $("#exp").on("click", function (){
    var data =  $('#dataset').DataTable().data()
    data = JSON.stringify(data)
    var dataset_name = {{name}}
    dataset_name = JSON.stringify(dataset_name)
    //var predicted = {{predicted}}
    //predicted = JSON.stringify(predicted)
     $.ajax({
                type: "get",
                url: "/exp_submit",
                dataType: "json",
                contentType: 'application/json;',
                data: { 'data': data, 'dataset_name': dataset_name, },
                //data: {queryData : JSON.stringify({'data': data, 'dataset_name': dataset_name})},
                success: function(data){


                    alert(data)
                },
                error: function(){
                    console.log("error");
                }
            });
    });

</script>



{% endblock %}